# Apache .htaccess for backend routes

RewriteEngine On

# NOTE:
# Do not set global CORS headers here.
# Individual PHP endpoints handle CORS dynamically (including credentialed requests).
# A wildcard origin (*) breaks fetch(..., { credentials: "include" }).
# Also avoid short-circuiting OPTIONS here, because editor endpoints must
# run PHP logic to validate origin and return the correct CORS headers.

# Protect configuration and internal/runtime folders from direct access
<Files "config.php">
    Order Allow,Deny
    Deny from all
</Files>
RewriteRule ^config/ - [F,L]
RewriteRule ^app/ - [F,L]
RewriteRule ^storage/ - [F,L]

# Route API requests (clean URLs)
RewriteRule ^api/SummarizeSearch/?$ api/SummarizeSearch.php [L,QSA]
RewriteRule ^api/TranslateTitle/?$ api/TranslateTitle.php [L,QSA]
RewriteRule ^api/SummarizeHTMLArticle/?$ api/SummarizeHTMLArticle.php [L,QSA]
RewriteRule ^api/SummarizePDFArticle/?$ api/SummarizePDFArticle.php [L,QSA]
RewriteRule ^api/CheckIfResourceIsForbidden/?$ api/CheckIfResourceIsForbidden.php [L,QSA]
RewriteRule ^api/nlm/esearch/?$ api/NlmSearch.php [L,QSA]
RewriteRule ^api/nlm/esummary/?$ api/NlmSummary.php [L,QSA]
RewriteRule ^api/nlm/efetch/?$ api/NlmFetch.php [L,QSA]

# Disable caching for backend PHP responses
<IfModule mod_headers.c>
    <FilesMatch "\.(php)$">
        Header set Cache-Control "no-cache, no-store, must-revalidate"
        Header set Pragma "no-cache"
        Header set Expires 0
    </FilesMatch>
</IfModule>
