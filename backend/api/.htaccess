# Apache .htaccess for API-specific CORS fallback

<IfModule mod_headers.c>
    # Apply permissive CORS to non-editor API endpoints only.
    <FilesMatch "^(?!Editor).+\.php$">
        Header always set Access-Control-Allow-Origin "*"
        Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS"
        Header always set Access-Control-Allow-Headers "Content-Type"
    </FilesMatch>

    # Editor endpoints: fallback CORS header reflection (no hardcoded domains).
    # Domain allow/deny is still enforced in PHP config logic.
    SetEnvIfNoCase Origin "^https?://[^/]+$" ORIGIN_ALLOWED=$0
    <FilesMatch "^Editor.+\.php$">
        Header always set Access-Control-Allow-Origin "%{ORIGIN_ALLOWED}e" env=ORIGIN_ALLOWED
        Header always set Access-Control-Allow-Credentials "true" env=ORIGIN_ALLOWED
        Header always set Vary "Origin" env=ORIGIN_ALLOWED
        Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS" env=ORIGIN_ALLOWED
        Header always set Access-Control-Allow-Headers "Content-Type, X-CSRF-Token" env=ORIGIN_ALLOWED
    </FilesMatch>
</IfModule>
