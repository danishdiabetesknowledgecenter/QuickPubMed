# Apache .htaccess fil til PHP Proxy
# SÃ¸rger for at requests til /api/* routes til de rigtige PHP filer

# Disable mod_security for this directory (can cause 403 on large POST requests)
<IfModule mod_security.c>
    SecFilterEngine Off
    SecFilterScanPOST Off
</IfModule>

# Alternative mod_security2 syntax
<IfModule mod_security2.c>
    SecRuleEngine Off
</IfModule>

RewriteEngine On

# CORS headers for all requests
<IfModule mod_headers.c>
    Header always set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization"
    Header always set Access-Control-Allow-Credentials "true"
</IfModule>

# Handle OPTIONS preflight requests - return 200 without processing
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule .* - [R=200,L]

# Beskyt config.php mod direkte adgang
<Files "config.php">
    Order Allow,Deny
    Deny from all
</Files>

# Route OpenAI API requests (handle both with and without trailing content)
RewriteRule ^api/SummarizeSearch/?$ api/SummarizeSearch.php [L,QSA]
RewriteRule ^api/TranslateTitle/?$ api/TranslateTitle.php [L,QSA]
RewriteRule ^api/SummarizeHTMLArticle/?$ api/SummarizeHTMLArticle.php [L,QSA]
RewriteRule ^api/SummarizePDFArticle/?$ api/SummarizePDFArticle.php [L,QSA]
RewriteRule ^api/CheckIfResourceIsForbidden/?$ api/CheckIfResourceIsForbidden.php [L,QSA]

# Route NLM/PubMed API requests
RewriteRule ^api/nlm/esearch/?$ api/NlmSearch.php [L,QSA]
RewriteRule ^api/nlm/esummary/?$ api/NlmSummary.php [L,QSA]
RewriteRule ^api/nlm/efetch/?$ api/NlmFetch.php [L,QSA]

# Disable caching for API responses
<IfModule mod_headers.c>
    <FilesMatch "\.(php)$">
        Header set Cache-Control "no-cache, no-store, must-revalidate"
        Header set Pragma "no-cache"
        Header set Expires 0
    </FilesMatch>
</IfModule>
